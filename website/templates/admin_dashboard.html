{% extends "layout.html" %}
{% block content %}
<div class="dashboard-header">
    <h2>Admin Dashboard</h2>
    <p>View and manage all user profile branches.</p>
</div>

{% if users %}
<div class="card">
    <h3>Impersonate User</h3>
    <p class="help-text">Click a user to log in as them and view their personal dashboard.</p>
    <div class="user-list">
        {% for user in users %}
            <a href="{{ url_for('views.impersonate', user_id=user.id) }}" class="button">{{ user.username }}</a>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if branches %}
<div class="card">
    <h3>Load Existing Profile (All Branches)</h3>
    <form id="load-profile-form">
        <select name="branch_name" id="branch-select" required>
            <option value="" disabled selected>-- Select a profile to edit --</option>
            {% for branch in branches %}
                <option value="{{ branch }}">{{ branch }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="button primary">Edit Selected</button>
    </form>
</div>
{% else %}
<div class="card">
    <p>No existing profiles found. You can create one using the button in the navigation bar.</p>
</div>
{% endif %}

<script>
    document.getElementById('load-profile-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const select = document.getElementById('branch-select');
        const branchName = select.value;
        if (branchName) {
            window.location.href = '/edit/' + branchName;
        }
    });
</script>
{% endblock %}